// Variables used by Scriptable
// Please type in the link to the photo into the Widget Parameter if you want an other picture
// Code by Nicolas
let dateForXmas = ''
let icon = 'ðŸŽ„';
let showDate = true
let widgetInputYear = new Date().getFullYear();
let widgetInputXmas ="-12-24";
let widgetInput = null;
let widgetInputDate = null;
let widgetInputParameter = args.widgetParameter;
let widgetInputUrl = "https://i.imgur.com/HSljMPe.jpg";
let textColor = '111111'
let XmasTextColor = "c90000"


widgetInputDate = widgetInputYear + widgetInputXmas;
widgetInput = widgetInputDate.toString().split(";");
dateForXmas = widgetInput[0].trim()

const localeDay = {â€‹
default: ['Day', 'Days'],
en: ['Day', 'Days'],
de: ['Tag', 'Tage'],
fr: ['Jour', 'Jours']
}â€‹

const localeHour = {â€‹
default: ['hours','hour'],
en: ['hours','hour'],
de: ['Stunden','Stunde'],
fr: ['heures','heure']
}â€‹

const localeMinute = {â€‹
default: ['minutes'],
en: ['minutes'],
de: ['Minuten'],
fr: ['minutes']
}â€‹

const localeXmas = {â€‹
default: ['Christmas'],
en: ['Christmas'],
de: ['Weihnachten'],
fr: ['NoÃ«l']
}â€‹

const localeHX ={â€‹
default: ['Merry'],
en: ['Merry'],
de: ['Frohe'],
fr: ['Joyeux']
}â€‹

const localeXmasT ={â€‹
default: ['Christmas'],
en: ['Christmas'],
de: ['Weihnachten'],
fr: ['NoÃ«l']
}â€‹

const localeUntil ={â€‹
default: ['until Christmas'],
en: ['until Christmas'],
de: ['bis Weihnachten'],
fr: ['Ã  NoÃ«l']
}â€‹

const languageCode = Device.preferredLanguages()[0].match(/^[\a-z]{â€‹2}â€‹/)
const HXtext = (localeHX[languageCode]) ? localeHX[languageCode] : localeHX.default
const days = (localeDay[languageCode]) ? localeDay[languageCode] : localeDay.default
const xmasTitle = (localeXmas[languageCode]) ? localeXmas[languageCode] : localeXmas.default
const UntilText = (localeUntil[languageCode]) ? localeUntil[languageCode] : localeUntil.default
const XmasText = (localeXmasT[languageCode]) ? localeXmasT[languageCode] : localeXmasT.default
const hours = (localeHour[languageCode]) ? localeHour[languageCode] : localeHour.default
////////////////////////////////////////////////////////////////////////////////

function getTimeRemaining(endtime){â€‹
const total = Date.parse(endtime) - Date.parse(new Date());
const seconds = Math.floor( (total/1000) % 60 );
const minutes = Math.floor( (total/1000/60) % 60 );
const hours = Math.floor( (total/(1000*60*60)) % 24 );
const days = Math.floor( total/(1000*60*60*24) );

return {â€‹
total,
days,
hours,
minutes,
seconds
}â€‹;
}â€‹

// Create Widget
let remainingDays = getTimeRemaining(dateForXmas).days+1;
let remainingHours = getTimeRemaining(dateForXmas).hours;
let remainingMinutes = getTimeRemaining(dateForXmas).minutes;
let rH = remainingHours + remainingDays*24;
let rM = remainingDays*24 + remainingHours*60;
if(remainingDays < 0)
{â€‹
var addDays = parseInt(widgetInputYear)
{â€‹
if (addDays % 4 == 0)
{â€‹
if (addDays % 100 == 0)
{â€‹
if (addDays % 400 == 0)
{â€‹
addDays = 366;
}â€‹
else
{â€‹
addDays = 365;
}â€‹
}â€‹
else
{â€‹
addDays = 366;
}â€‹
}â€‹
else
{â€‹
addDays = 365;
}â€‹
}â€‹

remainingDays = remainingDays + addDays
}â€‹
let widget = new ListWidget();
widget.setPadding(10, 10, 10, 10)
//Background-Image
if (widgetInputParameter != null && widgetInputParameter.length > 5)
{â€‹
let imgR = new Request(widgetInputParameter)
let img = await imgR.loadImage()
widget.backgroundImage = img
}â€‹
else
{â€‹
let imgQ = new Request(widgetInputUrl)
let imgN = await imgQ.loadImage()
widget.backgroundImage = imgN
}â€‹
//Day-Checker

if (remainingDays != 0)
{â€‹
if (Device.isPhone())
{â€‹
let provider = widget.addText(icon+xmasTitle)
provider.font = Font.boldMonospacedSystemFont(12)
provider.centerAlignText()
provider.textColor = new Color(textColor)
}â€‹
if (Device.isPad())
{â€‹
let provider = widget.addText(icon+xmasTitle+icon)
provider.font = Font.boldMonospacedSystemFont(12)
provider.centerAlignText()
provider.textColor = new Color(textColor)
}â€‹

widget.addSpacer()

let textStack = widget.addStack();
textStack.layoutHorizontally()
// if (Device.isPad())
// {â€‹
// textStack.addSpacer()
// }â€‹
textStack.addSpacer(6)
textStack.centerAlignContent()
textStack.addSpacer(5)



//textStack.addSpacer()

if (remainingDays<4)
{â€‹
let remainingDays2 = remainingDays -1
let remainingH = remainingHours+ remainingDays2*24
let daysText = textStack.addText(`${â€‹remainingH}â€‹`)
daysText.minimumScaleFactor = 0.5;
daysText.textColor = new Color(textColor)
if (Device.isPhone())
{â€‹
textStack.addSpacer(5)
}â€‹
if (Device.isPad())
{â€‹
textStack.addSpacer(30)
}â€‹
let postfixText
if (remainingH > 1)
{â€‹
postfixText = textStack.addText(hours[0])
}â€‹
else
{â€‹
postfixText = textStack.addText(hours[1])
}â€‹
postfixText.rightAlignText()
postfixText.textColor = new Color(textColor)
widget.addSpacer(20)
if (remainingH>10)
{â€‹
daysText.font = Font.boldMonospacedSystemFont(40)
daysText.leftAlignText()
postfixText.font = Font.boldMonospacedSystemFont(16)
}â€‹
else
{â€‹
daysText.font = Font.boldMonospacedSystemFont(50)
postfixText.font = Font.boldMonospacedSystemFont(20)
}â€‹
}â€‹
else
{â€‹
let daysText = textStack.addText(`${â€‹remainingDays}â€‹`)
daysText.minimumScaleFactor = 0.5;
daysText.textColor = new Color(textColor)
if (Device.isPhone())
{â€‹
textStack.addSpacer(5)
}â€‹
if (Device.isPad())
{â€‹
textStack.addSpacer(10)
}â€‹
let postfixText = textStack.addText(days[1])
postfixText.rightAlignText()
postfixText.textColor = new Color(textColor)
widget.addSpacer(10)
if (Device.isPad)
{â€‹
postfixText.font = Font.boldMonospacedSystemFont(25)
daysText.font = Font.boldMonospacedSystemFont(50)
}â€‹
else
{â€‹
postfixText.font = Font.boldMonospacedSystemFont(20)
daysText.font = Font.boldMonospacedSystemFont(30)
postfixText.leftAlignText()
}â€‹
}â€‹

let until = widget.addText(UntilText+"")
until.font = Font.boldMonospacedSystemFont(13)
until.leftAlignText()
until.centerAlignText()
until.textColor = new Color(textColor)//
widget.addSpacer(10)
if (remainingDays>100)
{â€‹
daysText.font = Font.boldMonospacedSystemFont(40)
daysText.leftAlignText()
postfixText.font = Font.boldMonospacedSystemFont(20)
}â€‹



}â€‹

// Christmas
if (remainingDays == 0)
{â€‹
widget.addSpacer(25)
let HXText = widget.addText(""+HXtext)
HXText.font = Font.boldRoundedSystemFont(20)
HXText.textColor = new Color(XmasTextColor)
HXText.centerAlignText()
widget.addSpacer(3)
let XMASText = widget.addText(""+XmasText)
XMASText.textColor = new Color(XmasTextColor)
XMASText.font = Font.boldRoundedSystemFont(20)
widget.addSpacer(10)
let IconText = widget.addText(""+icon+icon)
IconText.font = Font.regularSystemFont(58)
IconText.textColor = new Color(XmasTextColor)
}â€‹

let Widget = new ListWidget()
if(!config.runsInWidget) {â€‹
await widget.presentSmall()
}â€‹

// Show Widget.
Script.setWidget(widget)
Script.complete()
